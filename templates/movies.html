{% extends "base.html" %}
{% from "components/movie_card.html" import movie_card %}
{% from 'components/navigation.html' import top_nav, side_nav %}
{% from 'components/comments_tab.html' import comment_card %}

{% block title %}Movies - SenFlix{% endblock %}

{% block content %}
{# Removed debug script #}

{{ top_nav(current_user=current_user) }}

<div class="flex flex-row bg-black min-h-screen pt-16 snap-container" style="overflow-y: auto; height: 100vh;">
  {{ side_nav() }}
  
  <main id="main-content" class="flex-1 bg-black text-gray-100 transition-all duration-500 ease-in-out" style="margin-left: 16rem;">
    <div class="space-y-0">
      
      {# --- Hero Section --- #}
      <section class="relative h-screen flex items-end snap-section" id="hero">
        <div class="absolute inset-0">
          <img src="{{ url_for('static', filename='hero.png') }}" alt="Hero background" class="w-full h-full object-cover opacity-60">
          <div class="absolute inset-0 bg-gradient-to-t from-black via-black/80 to-transparent"></div>
        </div>
        <div class="relative z-10 p-8 w-full">
          <h1 class="text-4xl md:text-5xl font-bold mb-2">Welcome back, {{ current_user.name if current_user.is_authenticated else 'Guest' }}!</h1>
          <p class="text-lg text-gray-300">Discover new movies and keep track of your favorites.</p>
        </div>
      </section>

      {# --- New Releases Section --- #}
      <section id="new-releases" class="snap-section h-screen flex flex-col justify-end relative">
        <div class="absolute inset-0 z-0">
          <img src="{{ url_for('static', filename='sections/new-releases.jpg') }}" 
               alt="New Releases Background" 
               class="w-full h-full object-cover opacity-50">
          <div class="absolute inset-0 bg-gradient-to-t from-black via-black/90 to-black/70"></div>
        </div>
        <div class="relative z-10 p-8">
          <h2 class="text-2xl font-bold mb-4 text-gray-100">New Releases</h2>
          <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
            {% for movie in new_releases %}
              {{ movie_card(movie) }}
            {% else %}
              <p>No movies found.</p>
            {% endfor %}
          </div>
        </div>
      </section>

      {# --- Popular Section --- #}
      <section id="popular" class="snap-section h-screen flex flex-col justify-end relative">
        <div class="absolute inset-0 z-0">
          <img src="{{ url_for('static', filename='sections/popular.jpg') }}" 
               alt="Popular Background" 
               class="w-full h-full object-cover opacity-50">
          <div class="absolute inset-0 bg-gradient-to-t from-black via-black/70 to-transparent"></div>
        </div>
        <div class="relative z-10 p-8">
          <h2 class="text-2xl font-bold mb-4 text-gray-100">Popular</h2>
          <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
            {% for movie in popular_movies %}
              {{ movie_card(movie) }}
            {% else %}
              <p>No movies found.</p>
            {% endfor %}
          </div>
        </div>
      </section>

      {# --- Same Avatar Favorites Section --- #}
      {% if current_user.is_authenticated %}
        <section id="same-avatar-favorites" class="relative h-screen flex flex-col justify-end snap-section">
          {# Background Image #}
          <div class="absolute inset-0 z-0">
            <img src="{{ url_for('static', filename=current_user.avatar.hero_image_url) }}" 
                 alt="Background" 
                 class="w-full h-full object-cover object-center opacity-60">
            <div class="absolute inset-0 bg-gradient-to-t from-black via-black/70 to-transparent"></div>
          </div>
          
          {# Content #}
          <div class="relative z-10 p-8">
            <h2 class="text-3xl font-bold mb-8">Other {{ current_user.avatar.name }} Users' Favorites</h2>
            {% set users = same_avatar_favorites|map(attribute='user')|unique|list %}
            {% if users|length == 0 %}
              <div class="text-center text-gray-400 text-xl py-12">
                No other users with this avatar found.
              </div>
            {% else %}
              {# User Cards #}
              <div class="flex gap-4 mb-8 overflow-x-auto pb-4">
                {% for user in users %}
                  <div class="flex-shrink-0">
                    <a href="{{ url_for('user_profile', user_id=user.id) }}" 
                       class="flex flex-col items-center group">
                      <div class="w-12 h-12 rounded-full overflow-hidden border-2 border-blue-500 group-hover:border-white transition-all duration-300">
                        <img src="{{ url_for('static', filename=user.avatar.profile_image_url) }}" 
                             alt="{{ user.name }}" 
                             class="w-full h-full object-cover">
                      </div>
                      <span class="mt-2 text-sm text-gray-300 group-hover:text-white">{{ user.name }}</span>
                    </a>
                  </div>
                {% endfor %}
              </div>
              
              {# Movie Grid #}
              {% if same_avatar_favorites %}
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-6">
                  {% for fav in same_avatar_favorites %}
                    <div class="scale-90 hover:scale-100 transition-transform duration-300">
                      {{ movie_card(fav.movie) }}
                    </div>
                  {% endfor %}
                </div>
              {% else %}
                <div class="text-center text-gray-400 text-xl py-12">
                  No favorites from other users with this avatar yet.
                </div>
              {% endif %}
            {% endif %}
          </div>
        </section>
      {% endif %}

      {# --- Top Rated Section --- #}
      <section id="top-rated" class="snap-section h-screen flex flex-col justify-end relative">
        <div class="absolute inset-0 z-0">
          <img src="{{ url_for('static', filename='sections/top-rated.jpg') }}" 
               alt="Top Rated Background" 
               class="w-full h-full object-cover opacity-50">
          <div class="absolute inset-0 bg-gradient-to-t from-black via-black/70 to-transparent"></div>
        </div>
        <div class="relative z-10 p-8">
          <h2 class="text-2xl font-bold mb-4 text-gray-100">Top Rated by Community</h2>
          <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
            {% for movie in top_rated %}
              {{ movie_card(movie) }}
            {% else %}
              <p>No movies found.</p>
            {% endfor %}
          </div>
        </div>
      </section>

      {# --- Recent Comments Section --- #}
      <section id="recent-comments" class="snap-section h-screen flex flex-col justify-end relative">
        <div class="absolute inset-0 z-0">
          <img src="{{ url_for('static', filename='sections/comments.jpg') }}" 
               alt="Comments Background" 
               class="w-full h-full object-cover opacity-70">
          <div class="absolute inset-0 bg-gradient-to-t from-black via-black/70 to-transparent"></div>
        </div>
        <div class="relative z-10 p-8">
          <h2 class="text-2xl font-bold mb-4 text-gray-100">Community Comments</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5">
            {% if recent_comments and recent_comments|length > 0 %}
              {% for entry in recent_comments[:6] %}
                {{ comment_card(entry) }}
              {% endfor %}
            {% else %}
              <p>No comments yet.</p>
            {% endif %}
          </div>
        </div>
      </section>

      {# --- Category Sections --- #}
      {% for category in categories %}
      <section id="category-{{ category['id'] }}" class="snap-section h-screen relative flex flex-col justify-end">
        {# Background Image #}
        <div class="absolute inset-0 z-0">
          <img src="{{ url_for('static', filename='categories/' + (category['img'] or 'default-category.jpg')) }}"
               alt="{{ category['name'] }}"
               class="w-full h-full object-cover opacity-50"
               onerror="this.src='/static/categories/default-category.jpg';">
          <div class="absolute inset-0 bg-gradient-to-t from-black via-black/70 to-transparent"></div>
        </div>
        {# Content #}
        <div class="relative z-10 p-8">
          <h2 class="text-3xl font-bold mb-6 text-gray-100">{{ category['name'] }}</h2>
          <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
            {% set category_movies = category.get('movies', []) %}
            {% if category_movies %}
              {% for movie in category_movies %}
                {{ movie_card(movie) }}
              {% endfor %}
            {% else %}
              <p>No movies found in this category.</p>
            {% endif %}
          </div>
        </div>
      </section>
      {% endfor %}
    </div>
  </main>
</div>

{# Basic Styling #}
<style>
  body { 
    background: #000;
    overflow: hidden;
  }
  .sidebar-link { color: #e5e7eb; text-decoration: none; transition: color 0.2s; }
  .sidebar-link:hover { color: #ef4444; }
  .sidebar-link.active { color: #ef4444; font-weight: bold; }
  .sidebar-hidden { margin-left: 0 !important; }
  #sidebar { position: fixed; top: 4rem; left: 0; height: calc(100vh - 4rem); z-index: 40; }
  .snap-container { 
    scroll-snap-type: y mandatory;
    height: 100vh;
    overflow-y: scroll;
    scroll-behavior: smooth;
  }
  .snap-section { 
    scroll-snap-align: start;
    scroll-snap-stop: always;
    height: 100vh;
    position: relative;
    overflow: hidden;
  }
  
  /* Fade out effect for background images */
  .snap-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 30%;
    background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent);
    pointer-events: none;
    z-index: 2;
  }

  /* Ensure background images are visible */
  .snap-section .absolute.inset-0 {
    z-index: 0;
  }
  
  .snap-section .absolute.inset-0 img {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    opacity: 0.7 !important;
  }

  /* Avatar image container */
  .avatar-image-container {
    width: 12px;
    height: 12px;
    border-radius: 9999px;
    overflow: hidden;
    border: 1px solid;
  }

  /* Movie card avatar images */
  .movie-card-3d-wrapper img[alt="Watched by user"] {
    width: 1.25rem !important;
    height: 1.25rem !important;
    border-width: 1px !important;
  }

  .glass-modal {
    background: rgba(30, 41, 59, 0.7);
    box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
    border-radius: 1.5rem;
    border: 1px solid rgba(255,255,255,0.18);
    backdrop-filter: blur(12px);
  }
  .rating-star {
    transition: transform 0.2s, color 0.2s;
    color: #6B7280;
  }
  .rating-star.selected, .rating-star.text-yellow-400 {
    color: #FBBF24 !important;
    transform: scale(1.15);
  }
  .rating-star:hover {
    transform: scale(1.2);
  }
</style>

{# --- Rating Modal --- #}
<div id="ratingModal" class="fixed inset-0 bg-black/60 backdrop-blur-md hidden items-center justify-center z-[9999]">
  <div class="glass-modal bg-white/10 backdrop-blur-lg p-8 rounded-2xl max-w-md w-full mx-4 shadow-2xl border border-white/20 relative">
    <button type="button" onclick="hideRatingModal()" class="absolute top-4 right-4 text-gray-300 hover:text-white text-xl">&times;</button>
    <div id="modalMovieInfo" class="flex items-center mb-6">
      <img id="modalPoster" src="" alt="Poster" class="w-16 h-24 object-cover rounded-lg shadow mr-4 border border-white/20">
      <div>
        <h2 id="modalTitle" class="text-xl font-bold text-white mb-1">Movie Title</h2>
        <div id="modalYear" class="text-gray-200 text-sm">Year</div>
      </div>
    </div>
    <form id="ratingForm" class="space-y-6">
      <input type="hidden" id="modalMovieId" name="movie_id">
      <div>
        <label class="block text-sm font-medium mb-2 text-white">Your Rating (1-10 Stars)</label>
        <div class="flex items-center space-x-1" id="starRatingContainer">
          {% for i in range(1, 11) %}
          <button type="button" 
                  class="rating-star w-7 h-7 text-gray-500 hover:text-yellow-400 transition-colors duration-150" 
                  data-value="{{ i }}">
            <svg fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
          </button>
          {% endfor %}
        </div>
        <input type="hidden" id="ratingValue" name="rating" value="0">
      </div>
      <div>
        <label for="comment" class="block text-sm font-medium mb-2 text-white">Your Comment (Optional)</label>
        <textarea id="comment" name="comment" rows="3"
                  class="w-full px-3 py-2 rounded-lg bg-white/10 border border-white/20 focus:border-red-500 focus:ring-1 focus:ring-red-500 text-white placeholder-gray-300"></textarea>
      </div>
      <div class="flex justify-end space-x-4">
        <button type="button" onclick="hideRatingModal()" 
                class="px-4 py-2 rounded-lg border border-gray-400 text-gray-200 hover:bg-white/10 transition-colors">
          Cancel
        </button>
        <button type="submit" 
                class="px-4 py-2 rounded-lg bg-red-600 hover:bg-red-700 text-white transition-colors">
          Submit Rating
        </button>
      </div>
    </form>
  </div>
</div>

{# --- JavaScript --- #}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Removed image fallback logic

    // --- Rating Modal Logic ---
    let selectedRating = 0;
    const ratingContainer = document.getElementById('starRatingContainer');
    const ratingInput = document.getElementById('ratingValue');
    const stars = ratingContainer.querySelectorAll('.rating-star');

    // Show rating modal function
    window.showRatingModal = function(movieId) {
        // Fetch movie info from card
        const card = document.querySelector(`.movie-card-wrapper[data-movie-id="${movieId}"]`);
        if (card) {
            const poster = card.querySelector('.poster-bg').style.backgroundImage;
            const title = card.querySelector('h3')?.textContent || '';
            const year = card.querySelector('.text-xs span')?.textContent || '';
            document.getElementById('modalPoster').src = poster ? poster.replace('url("','').replace('")','') : '';
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalYear').textContent = year;
        }
        document.getElementById('modalMovieId').value = movieId;
        document.getElementById('ratingModal').classList.remove('hidden');
        document.getElementById('ratingModal').classList.add('flex');
    }
    window.hideRatingModal = function() {
        document.getElementById('ratingModal').classList.add('hidden');
        document.getElementById('ratingModal').classList.remove('flex');
    }
    function updateStarsVisual(rating) {
        stars.forEach(star => {
            star.classList.toggle('text-yellow-400', parseInt(star.dataset.value) <= rating);
            star.classList.toggle('selected', parseInt(star.dataset.value) <= rating);
            star.classList.toggle('text-gray-500', parseInt(star.dataset.value) > rating);
        });
    }
    stars.forEach(star => {
        star.addEventListener('click', () => {
            selectedRating = parseInt(star.dataset.value);
            ratingInput.value = selectedRating;
            updateStarsVisual(selectedRating);
        });
    });
    document.getElementById('ratingForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const submitButton = e.target.querySelector('button[type="submit"]');
        submitButton.disabled = true;
        submitButton.textContent = 'Saving...';
        const formData = new FormData(e.target);
        if (parseInt(formData.get('rating')) <= 0) {
            alert('Please select a rating.');
            submitButton.disabled = false;
            submitButton.textContent = 'Submit Rating';
            return;
        }
        try {
            const response = await fetch('/rate_movie', {
                method: 'POST',
                body: new URLSearchParams(formData)
            });
            const result = await response.json();
            if (response.ok && result.success) {
                hideRatingModal();
                document.querySelectorAll(`.movie-card-wrapper[data-movie-id="${formData.get('movie_id')}"] .rate-btn`).forEach(btn => btn.classList.add('active'));
                const successMessage = document.createElement('div');
                successMessage.className = 'fixed bottom-4 right-4 bg-green-600 text-white px-4 py-2 rounded-lg shadow-lg transition-opacity duration-500';
                successMessage.textContent = 'Rating saved successfully!';
                document.body.appendChild(successMessage);
                setTimeout(() => {
                    successMessage.style.opacity = '0';
                    setTimeout(() => successMessage.remove(), 500);
                }, 3000);
            } else {
                throw new Error(result.error || 'Error saving rating');
            }
        } catch (error) {
            alert('Error saving rating: ' + error.message);
        } finally {
            submitButton.disabled = false;
            submitButton.textContent = 'Submit Rating';
        }
    });

    // --- Movie Card & Comment Card 3D Hover Effect ---
    function initialize3DHoverEffect(selector) {
        const cardWrappers = document.querySelectorAll(selector);
        cardWrappers.forEach(wrapper => {
            // Prevent attaching multiple listeners
            if (wrapper.dataset.interactiveAttached === 'true') return;
            wrapper.dataset.interactiveAttached = 'true';

            // Only apply to movie cards now
            const card = wrapper.querySelector('.movie-card-3d'); 
            if (!card) return;

            const tiltIntensity = 10; // Adjust tilt intensity

            wrapper.addEventListener('mousemove', (e) => {
                const rect = wrapper.getBoundingClientRect();
                // Calculate position relative to the card center
                const x = e.clientX - rect.left - rect.width / 2;
                const y = e.clientY - rect.top - rect.height / 2;
                // Calculate rotation angles
                const rotateY = (x / (rect.width / 2)) * tiltIntensity;
                const rotateX = (y / (rect.height / 2)) * -tiltIntensity;
                // Apply the transform
                card.style.transform = `rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale(1.03)`;
            });

            wrapper.addEventListener('mouseleave', () => {
                card.style.transform = 'rotateX(0deg) rotateY(0deg) scale(1)'; // Reset transform
            });
        });
    }
    initialize3DHoverEffect('.movie-card-3d-wrapper'); // Initialize ONLY for movie cards
    // initialize3DHoverEffect('.comment-card-3d-wrapper'); // Definitely remove call for comments

    // --- Movie Action Button Handlers ---
    async function handleMovieAction(buttonElement, actionType) {
        const movieId = buttonElement.dataset.movieId;
        if (!movieId) {
            console.error('Movie ID not found on button');
            return;
        }

        const wasActive = buttonElement.classList.contains('active');
        const titleAdd = buttonElement.title;
        const titleRemove = buttonElement.title.replace('Add', 'Remove').replace('Mark as', 'Mark as Un');

        // Add processing state
        buttonElement.classList.add('processing');

        // Determine endpoint based on action type
        const endpoint = actionType === 'watchlist' ? '/toggle_watchlist/' + movieId : '/toggle_watched/' + movieId;

        try {
            const response = await fetch(endpoint, { method: 'POST' });
            const result = await response.json();
            
            if (!response.ok || result.error) {
                throw new Error(result.error || 'Server error');
            }
            
            // Success - Update all instances of this movie card
            const isNowActive = !wasActive;
            document.querySelectorAll(`.movie-card-wrapper[data-movie-id="${movieId}"]`).forEach(card => {
                const actionBtnClass = actionType === 'watchlist' ? '.watchlist-btn' : '.watched-btn';
                const button = card.querySelector(actionBtnClass);
                if (button) {
                    button.classList.toggle('active', isNowActive);
                }
            });
            
            // Emit a custom event for UI updates
            document.dispatchEvent(new CustomEvent('movieStatusChanged', {
                detail: { 
                    movieId,
                    actionType,
                    isActive: isNowActive 
                }
            }));
            
        } catch (error) {
            console.error(`Failed to toggle ${actionType}:`, error);
            // Revert UI on error
            buttonElement.classList.toggle('active', wasActive);
            buttonElement.title = wasActive ? titleRemove : titleAdd;
        } finally {
            // Remove processing state
            buttonElement.classList.remove('processing');
        }
    }

    // Handle opening the rating modal
    function handleRatingButtonClick(button) {
        const movieId = button.dataset.movieId;
        if (!movieId) {
            console.error('Movie ID not found on rate button');
            return;
        }
        
        // Visual feedback - add processing class
        button.classList.add('processing');
        
        // Fetch existing rating data
        fetch(`/get_movie_rating/${movieId}`)
            .then(response => response.json())
            .then(data => {
                const ratingValue = document.getElementById('ratingValue');
                const commentText = document.getElementById('comment');
                
                if (data.rating) {
                    // Pre-fill the rating form with existing data
                    ratingValue.value = data.rating;
                    commentText.value = data.comment || '';
                    updateStarsVisual(data.rating);
                } else {
                    // Reset form for new rating
                    ratingValue.value = '';
                    commentText.value = '';
                    updateStarsVisual(0);
                }
                
                // Show the modal
                showRatingModal(movieId);
            })
            .catch(error => {
                console.error('Error fetching rating:', error);
                showRatingModal(movieId);
            })
            .finally(() => {
                // Remove processing state
                button.classList.remove('processing');
            });
    }

    // Event delegation for action buttons
    document.addEventListener('click', function(event) {
        const watchlistButton = event.target.closest('.watchlist-btn');
        const watchedButton = event.target.closest('.watched-btn');
        const rateButton = event.target.closest('.rate-btn');

        if (watchlistButton) {
            handleMovieAction(watchlistButton, 'watchlist');
        } else if (watchedButton) {
            handleMovieAction(watchedButton, 'watched');
        } else if (rateButton) {
            handleRatingButtonClick(rateButton);
        }
    });

    // Movie status change listener for UI updates
    document.addEventListener('movieStatusChanged', function(event) {
        const { movieId, actionType, isActive } = event.detail;
        
        // Refresh the relevant sections if needed
        if (actionType === 'watchlist' || actionType === 'watched') {
            // Could add code here to refresh the watchlist/watched sections
            console.log(`${actionType} state changed for movie ${movieId}: ${isActive ? 'active' : 'inactive'}`);
        }
    });

    // --- General UI & Navigation Logic ---
    
    // Filter logic (placeholder)
    const categoryFilter = document.getElementById('category-filter');
    const platformFilter = document.getElementById('platform-filter');
    function applyFilters() {
        const categoryId = categoryFilter ? categoryFilter.value : null;
        const platformId = platformFilter ? platformFilter.value : null;
        console.log('Filtering - Category:', categoryId, 'Platform:', platformId);
        // Add actual filtering logic here (e.g., redirect or AJAX fetch)
    }
    if (categoryFilter) categoryFilter.addEventListener('change', applyFilters);
    if (platformFilter) platformFilter.addEventListener('change', applyFilters);

    // Scrollspy for sidebar
    const sidebarLinks = document.querySelectorAll('.sidebar-link');
    const sections = document.querySelectorAll('.snap-section');
    const mainContent = document.getElementById('main-content');
    
    function setActiveLink() {
        if (!mainContent) return;
        let currentSectionId = null;
        const scrollPosition = mainContent.scrollTop + (window.innerHeight * 0.3); // Offset for better detection

        sections.forEach(section => {
            if (section.offsetTop <= scrollPosition && 
                section.offsetTop + section.offsetHeight > scrollPosition) {
                currentSectionId = section.getAttribute('id');
            }
        });

        sidebarLinks.forEach(link => {
            link.classList.remove('active');
            const href = link.getAttribute('href');
            if (href && href === `#${currentSectionId}`) {
                link.classList.add('active');
            }
        });
        
        // Default to first if none found (e.g., at top)
        if (!currentSectionId && sidebarLinks.length > 0) {
             const firstVisibleSection = sections[0] ? sections[0].id : null;
             if(firstVisibleSection){
                 const firstLink = document.querySelector(`.sidebar-link[href="#${firstVisibleSection}"]`);
                 if(firstLink) firstLink.classList.add('active');
             }
        }
    }
    
    // Use main content scroll event if sidebar is fixed
    if (mainContent) {
        mainContent.addEventListener('scroll', setActiveLink);
    }
    // Set initial active link on load
    setActiveLink(); 

    // Add CSS for processing state
    const style = document.createElement('style');
    style.textContent = `
        .action-btn.processing {
            animation: pulse 1s infinite;
            pointer-events: none;
        }
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }
    `;
    document.head.appendChild(style);
});
</script>
{% endblock %}