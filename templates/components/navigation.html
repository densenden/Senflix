{% macro top_nav(current_user=None) %}
<nav class="fixed top-0 left-0 right-0 bg-black/80 backdrop-blur-sm z-50 border-b border-gray-800">
    <div class="container mx-auto px-4">
        <div class="flex items-center justify-between h-16">
            <a href="{{ url_for('movies') }}" class="flex items-center">
                <img src="{{ url_for('static', filename='logos/senflix.svg') }}" alt="SenFlix Logo" class="h-10 w-auto">
            </a>
            <div class="flex items-center space-x-4">
                {% if current_user and current_user.is_authenticated %}
                    <a href="{{ url_for('user_profile', user_id=current_user.id) }}" class="flex items-center space-x-2 group">
                        <img src="{{ url_for('static', filename='avatars/profile/avatar_' ~ current_user.avatar_id ~ '.jpg') }}" alt="{{ current_user.name }}" class="w-8 h-8 rounded-full border-2 border-yellow-400 group-hover:border-white transition">
                        <span class="text-gray-200 group-hover:text-white font-semibold">{{ current_user.name }}</span>
                    </a>
                {% endif %}
            </div>
        </div>
    </div>
</nav>
{% endmacro %}

{% macro side_nav(anchors=None, categories=None) %}
<aside id="sidebar" class="relative w-64 bg-black/80 backdrop-blur-sm overflow-y-auto transition-transform duration-500" style="transform: translateX(0); min-height: calc(100vh - 4rem);">
    <div class="p-4">
        {% if anchors %}
        <h3 class="text-lg font-semibold mb-4">Sections</h3>
        <ul class="space-y-2 mb-8">
            {% for anchor in anchors %}
                <li>
                    <a href="#{{ anchor.id }}" class="sidebar-link text-gray-300 hover:text-white" data-section="{{ anchor.id }}">
                        {{ anchor.label }}
                    </a>
                </li>
            {% endfor %}
        </ul>
        {% endif %}
        {% if categories %}
        <h3 class="text-lg font-semibold mb-4">Categories</h3>
        <ul class="space-y-2">
            {% for category in categories %}
                <li>
                    <a href="#category-{{ category.id }}" class="sidebar-link text-gray-300 hover:text-white" data-section="category-{{ category.id }}">
                        {{ category.name }}
                    </a>
                </li>
            {% endfor %}
        </ul>
        {% endif %}
    </div>
</aside>
<script>
(function() {
  let sidebar = document.getElementById('sidebar');
  let main = document.getElementById('main-content');
  let timer;
  function slideOut() {
    sidebar.style.transform = 'translateX(-100%)';
    if(main) main.style.marginLeft = '0';
  }
  function slideIn() {
    sidebar.style.transform = 'translateX(0)';
    if(main) main.style.marginLeft = '16rem';
  }
  function resetTimer() {
    slideIn();
    clearTimeout(timer);
    timer = setTimeout(slideOut, 3000);
  }
  ['mousemove','keydown','touchstart'].forEach(evt => {
    document.addEventListener(evt, resetTimer, {passive:true});
  });
  resetTimer();

  // Scrollspy
  const links = document.querySelectorAll('#sidebar .sidebar-link');
  const sections = [...links].map(link => document.getElementById(link.dataset.section)).filter(Boolean);
  function onScroll() {
    let scrollPos = window.scrollY + 80;
    let activeIdx = -1;
    for(let i=0; i<sections.length; i++) {
      if(sections[i].offsetTop <= scrollPos) activeIdx = i;
    }
    links.forEach((l, i) => l.classList.toggle('text-red-500', i===activeIdx));
  }
  window.addEventListener('scroll', onScroll);
  onScroll();
})();
</script>
{% endmacro %}